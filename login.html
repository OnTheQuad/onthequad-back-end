<html lang="en">
  <head>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
  </head>
  <body>
    <script>
    function signIn() {
      var auth = gapi.auth2.getAuthInstance();
      if(!auth.currentUser.get().isSignedIn()){
        auth.signIn().then(function () {
          $('#signOut').show();
          $('#signIn').hide();
          var auth_res = auth.currentUser.get().getAuthResponse();
          console.log('Access_token: ' + auth_res.acces_token);
          console.log('ID_token: ' + auth_res.id_token);
          console.log('Expires in: ' + auth_res.expires_in);
          console.log('Expires at: ' + auth_res.expires_at);
          var xhr = new XMLHttpRequest();
          xhr.open('POST', 'http://localhost:5000/auth');
          xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
          xhr.onload = function() {
            console.log('Signed in as: ' + xhr.responseText);
          };
          xhr.send('idtoken=' + auth_res.id_token);
        }, function(reason) {
          console.log(reason.body)
        });
      }
    };
    function signOut(){
      var auth = gapi.auth2.getAuthInstance();
      auth.signOut().then(function () {
        $('#signOut').hide();
        $('#signIn').show();
        console.log('User signed out.');
      });
    }

    function onLoad() {
      gapi.load('auth2', function(){
        gapi.auth2.init({
          client_id     : '441857043088-ujkkfjr5f66e1j4qq02iueink9d5fcj8.apps.googleusercontent.com',
          scope         : 'profile email',
          hosted_domain : 'uconn.edu',
          cookie_policy : 'single_host_origin'
        }).then(function() {
          var auth = gapi.auth2.getAuthInstance()
          if (auth.isSignedIn.get() == true) {
            $('#signOut').show();
            $('#signIn').hide();
            var prof = auth.currentUser.get().getBasicProfile();
            var auth_res = auth.currentUser.get().getAuthResponse();
            console.log('Access_token: ' + auth_res.acces_token);
            console.log('ID_token: ' + auth_res.id_token);
            console.log('Expires in: ' + auth_res.expires_in);
            console.log('Expires at: ' + auth_res.expires_at);
            console.log('User: ' + prof.getName())
            console.log('Email: ' + prof.getEmail())
          } else {
            $('#signOut').hide();
            $('#signIn').show();
          }
        }, function(reason){});
      });
    };
    </script>
    <button id="signIn" onclick="signIn()" style="display:none">Sign-in</a>
    <button id="signOut" onclick="signOut()" style="display:none">Sign-out</a>
    <script src="https://apis.google.com/js/platform.js?onload=onLoad" async defer></script>
  </body>
</html>